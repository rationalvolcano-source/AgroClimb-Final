import React, { useState } from "react";

/**
 * TAV Games Hub – ultra‑lean React front end for 3 games
 * ------------------------------------------------------
 * - No external router; hash navigation (token‑efficient for Replit)
 * - Inline SVG logos (no image assets)
 * - Stream chooser shown on card click
 * - Flashcard Duel -> opens your existing Lovable app with ?stream=
 * - Other two games show an Under Construction screen (can be wired later)
 * - Tailwind‑ready classes; safe to run without Tailwind as well
 *
 * How to use
 * 1) Drop this as App.jsx/App.tsx in Replit React template
 * 2) Ensure index renders <App />
 * 3) (Optional) Adjust duelBaseUrl if you host elsewhere
 */

const duelBaseUrl = "https://duel-quiz-react.lovable.app/";

const STREAMS = [
  "JRF Horticulture",
  "Banking – English",
  "Banking – Quants & Data Interpretation",
  "Banking – Logical Reasoning",
  "Banking – Financial & Banking Affairs",
  "ABM – VARC",
  "ABM – DILR",
  "ABM – QA",
  "Banking – Agri Affairs",
];

export default function App() {
  const [route, setRoute] = useState(window.location.hash.replace("#", "") || "home");
  const [pendingGame, setPendingGame] = useState(null as null | GameId);
  const [stream, setStream] = useState<string>("");

  React.useEffect(() => {
    const onHash = () => setRoute(window.location.hash.replace("#", "") || "home");
    window.addEventListener("hashchange", onHash);
    return () => window.removeEventListener("hashchange", onHash);
  }, []);

  function openChooser(game: GameId) {
    setPendingGame(game);
  }

  function startGame() {
    if (!pendingGame || !stream) return;
    if (pendingGame === "flashcard") {
      const url = new URL(duelBaseUrl);
      url.searchParams.set("stream", stream);
      window.open(url.toString(), "_blank", "noopener,noreferrer");
    } else {
      window.location.hash = `game-${pendingGame}`;
    }
    // reset
    setPendingGame(null);
    setStream("");
  }

  return (
    <div className="min-h-screen bg-slate-950 text-slate-50">
      <TopNav onNavigate={(r)=>{window.location.hash = r;}} />

      {route === "home" && (
        <main className="max-w-6xl mx-auto px-4 py-8">
          <Hero />
          <div className="grid md:grid-cols-3 gap-6 mt-8">
            <GameCard
              title="Flashcard Duel"
              subtitle="Rapid recall battles"
              description="Answer fast, build streaks, dominate the leaderboard."
              onClick={() => openChooser("flashcard")}
              Logo={LogoDuel}
              accent="emerald"
            />
            <GameCard
              title="Logic Orchard"
              subtitle="Reasoning • Match‑3"
              description="Match symbols, unlock combos, train your LR muscle."
              onClick={() => openChooser("logic")}
              Logo={LogoOrchard}
              accent="cyan"
            />
            <GameCard
              title="Number Sprint"
              subtitle="Quants • Speed run"
              description="Timed DI/QA sprints with clean visuals and instant feedback."
              onClick={() => openChooser("sprint")}
              Logo={LogoSprint}
              accent="violet"
            />
          </div>
        </main>
      )}

      {route === "game-logic" && <UnderConstruction title="Logic Orchard" />} 
      {route === "game-sprint" && <UnderConstruction title="Number Sprint" />} 

      {!!pendingGame && (
        <ChooserModal
          onClose={() => setPendingGame(null)}
          onStart={startGame}
          value={stream}
          setValue={setStream}
          game={pendingGame}
        />
      )}

      <Footer />
    </div>
  );
}

// Types
export type GameId = "flashcard" | "logic" | "sprint";

function TopNav({ onNavigate }: { onNavigate: (r: string)=>void }) {
  return (
    <header className="sticky top-0 z-40 border-b border-slate-800 bg-slate-950/80 backdrop-blur">
      <div className="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
        <div className="flex items-center gap-2">
          <StarIcon className="h-5 w-5 text-emerald-400" />
          <span className="font-semibold tracking-tight">TAV Games</span>
        </div>
        <nav className="hidden md:flex items-center gap-6 text-sm opacity-90">
          <button className="hover:opacity-100 opacity-80" onClick={()=>onNavigate("home")}>Home</button>
          <a className="hover:opacity-100 opacity-80" href="https://duel-quiz-react.lovable.app/" target="_blank" rel="noreferrer">JRF Horticulture Duel</a>
          <a className="hover:opacity-100 opacity-80" href="#">Docs</a>
        </nav>
      </div>
    </header>
  );
}

function Hero() {
  return (
    <section className="rounded-3xl border border-slate-800 bg-slate-900/50 p-6">
      <div className="grid md:grid-cols-2 gap-6 items-center">
        <div>
          <h1 className="text-3xl md:text-5xl font-semibold leading-tight">Play your way to mastery.</h1>
          <p className="text-slate-300 mt-3">Three code‑light, visually clean games designed for low‑latency Replit hosting. Pick a stream and start.</p>
          <ul className="text-sm text-slate-400 grid grid-cols-2 gap-2 mt-4">
            <li>Fast loads</li>
            <li>Minimal deps</li>
            <li>Clean typography</li>
            <li>Mobile‑friendly</li>
          </ul>
        </div>
        <div className="grid grid-cols-3 gap-3">
          <LogoDuel className="w-full" />
          <LogoOrchard className="w-full" />
          <LogoSprint className="w-full" />
        </div>
      </div>
    </section>
  );
}

function GameCard({ title, subtitle, description, onClick, Logo, accent }: {
  title: string; subtitle: string; description: string; onClick: ()=>void; Logo: React.FC<any>; accent: "emerald"|"cyan"|"violet";
}) {
  const accentRing = accent === "emerald" ? "ring-emerald-400/40" : accent === "cyan" ? "ring-cyan-400/40" : "ring-violet-400/40";
  return (
    <button onClick={onClick} className={`text-left rounded-2xl border border-slate-800 bg-slate-900/60 p-4 hover:border-slate-700 transition ring-1 ${accentRing}`}>
      <div className="h-28 flex items-center"><Logo className="h-20 w-auto mx-auto" /></div>
      <div className="mt-3">
        <div className="text-lg font-semibold">{title}</div>
        <div className="text-xs uppercase tracking-wide text-slate-400">{subtitle}</div>
        <p className="text-sm text-slate-300 mt-2">{description}</p>
      </div>
    </button>
  );
}

function ChooserModal({ onClose, onStart, value, setValue, game }: {
  onClose: ()=>void; onStart: ()=>void; value: string; setValue: (v:string)=>void; game: GameId;
}) {
  return (
    <div className="fixed inset-0 z-50 grid place-items-center">
      <div className="absolute inset-0 bg-black/60" onClick={onClose} />
      <div className="relative w-full max-w-lg rounded-2xl border border-slate-800 bg-slate-900 p-5">
        <div className="text-lg font-semibold">Choose your stream</div>
        <p className="text-slate-400 text-sm">Select a stream to launch <b>{game === "flashcard" ? "Flashcard Duel" : game === "logic" ? "Logic Orchard" : "Number Sprint"}</b>.</p>
        <select
          className="mt-3 w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 outline-none"
          value={value}
          onChange={(e)=>setValue(e.target.value)}
        >
          <option value="">-- Select a stream --</option>
          {STREAMS.map((s)=> <option key={s} value={s}>{s}</option>)}
        </select>
        <div className="mt-4 flex items-center gap-3 justify-end">
          <button onClick={onClose} className="px-3 py-2 rounded-lg bg-slate-800 hover:bg-slate-700">Cancel</button>
          <button onClick={onStart} disabled={!value} className="px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-500 disabled:opacity-40">Start</button>
        </div>
      </div>
    </div>
  );
}

function UnderConstruction({ title }: { title: string }) {
  return (
    <main className="max-w-3xl mx-auto px-4 py-16 text-center">
      <h2 className="text-3xl font-semibold">{title}</h2>
      <p className="text-slate-400 mt-2">This game is under construction. Your selected stream will be supported at launch.</p>
      <div className="mt-6 inline-flex items-center gap-2 rounded-xl border border-slate-800 bg-slate-900 px-4 py-2 text-sm">
        <StarIcon className="h-4 w-4 text-emerald-400" />
        <span>Check back soon</span>
      </div>
      <div className="mt-8">
        <a href="#home" className="text-emerald-400 underline">Back to hub</a>
      </div>
    </main>
  );
}

function Footer() {
  return (
    <footer className="max-w-6xl mx-auto px-4 py-8 text-sm text-slate-400">
      <div className="flex items-center gap-2"><StarIcon className="h-4 w-4 text-emerald-400"/><span>TAV Career Compass</span></div>
      <div className="opacity-60 mt-1">© {new Date().getFullYear()} All rights reserved.</div>
    </footer>
  );
}

// ---------------- Logos (inline SVG; token‑efficient) ----------------
function StarIcon(props: React.SVGProps<SVGSVGElement>) {
  return (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" {...props}>
      <path strokeWidth="1.6" d="M12 2l2.4 5 5.6.6-4.1 3.8 1.2 5.6L12 14.8 6.9 17l1.2-5.6L4 7.6 9.6 7 12 2z"/>
    </svg>
  );
}

function LogoDuel({ className = "h-16" }: { className?: string }) {
  return (
    <svg className={className} viewBox="0 0 200 80" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="g1" x1="0" x2="1">
          <stop offset="0" stopColor="#34d399"/>
          <stop offset="1" stopColor="#22d3ee"/>
        </linearGradient>
      </defs>
      <rect x="0" y="0" width="200" height="80" rx="16" fill="#0b1220" stroke="#1f2937"/>
      <circle cx="40" cy="40" r="22" fill="url(#g1)" opacity="0.25"/>
      <text x="40" y="46" textAnchor="middle" fontFamily="ui-sans-serif,system-ui" fontSize="18" fill="#34d399">VS</text>
      <text x="78" y="47" fontFamily="ui-sans-serif,system-ui" fontSize="22" fill="#e5e7eb">Flashcard Duel</text>
    </svg>
  );
}

function LogoOrchard({ className = "h-16" }: { className?: string }) {
  return (
    <svg className={className} viewBox="0 0 200 80" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="g2" x1="0" x2="1">
          <stop offset="0" stopColor="#22d3ee"/>
          <stop offset="1" stopColor="#34d399"/>
        </linearGradient>
      </defs>
      <rect x="0" y="0" width="200" height="80" rx="16" fill="#0b1220" stroke="#1f2937"/>
      <g transform="translate(26,18)">
        <rect x="0" y="20" width="24" height="24" rx="6" fill="url(#g2)" opacity="0.25"/>
        <rect x="28" y="8" width="24" height="36" rx="6" fill="url(#g2)" opacity="0.35"/>
        <rect x="56" y="0" width="24" height="44" rx="6" fill="url(#g2)" opacity="0.45"/>
      </g>
      <text x="100" y="47" fontFamily="ui-sans-serif,system-ui" fontSize="22" fill="#e5e7eb" textAnchor="middle">Logic Orchard</text>
    </svg>
  );
}

function LogoSprint({ className = "h-16" }: { className?: string }) {
  return (
    <svg className={className} viewBox="0 0 200 80" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="g3" x1="0" x2="1">
          <stop offset="0" stopColor="#a78bfa"/>
          <stop offset="1" stopColor="#22d3ee"/>
        </linearGradient>
      </defs>
      <rect x="0" y="0" width="200" height="80" rx="16" fill="#0b1220" stroke="#1f2937"/>
      <path d="M28 52c18-10 30-22 48-28 18-6 38-6 64-2" stroke="url(#g3)" strokeWidth="3" fill="none"/>
      <text x="110" y="47" fontFamily="ui-sans-serif,system-ui" fontSize="22" fill="#e5e7eb" textAnchor="middle">Number Sprint</text>
    </svg>
  );
}